<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HindiClip ‚Äî Viral reels for Hindi creators</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body data-supabase-url="https://your-project.supabase.co" data-supabase-anon-key="public-anon-key">
    <header class="hero">
      <nav class="nav">
        <div class="logo">HindiClip</div>
        <div class="nav-links">
          <a href="#upload">Upload</a>
          <a href="#features">Features</a>
          <a href="#workflow">Workflow</a>
          <a href="#faq">FAQ</a>
        </div>
        <div class="nav-actions">
          <a class="cta" href="#upload">Get early access</a>
          <button
            type="button"
            class="user-pill"
            id="user-pill"
            hidden
            aria-controls="user-dashboard"
            aria-expanded="false"
          >
            <span class="user-avatar" id="user-avatar" aria-hidden="true">HC</span>
            <span class="user-name" id="user-name">User</span>
          </button>
        </div>
      </nav>
      <div class="hero-content">
        <div class="hero-text">
          <p class="tag">Built for Hindi creators</p>
          <h1>HindiClip builds viral reels from any Hindi video.</h1>
          <p class="subtitle">
            Upload any long Hindi or Hinglish video and HindiClip finds the punchiest bits,
            adds bold captions, and hands back a ready-to-post short under 60 seconds.
          </p>
          <div class="hero-actions">
            <a class="primary upload-trigger" href="#upload" data-upload-trigger="true"
              >Upload your video</a
            >
            <a class="secondary" href="#workflow">Preview the pipeline</a>
          </div>
          <div class="social-proof">
            <div class="avatars">
              <span class="avatar">‡§Ü‡§∞</span>
              <span class="avatar">MK</span>
              <span class="avatar">ZS</span>
            </div>
            <p>
              Loved by educators, comedians, and news creators shipping Hinglish
              shorts daily.
            </p>
          </div>
        </div>
          <div class="hero-card hero-card--glow" id="upload">
          <div class="card-body upload-card">
            <input type="file" id="upload-input" hidden accept="video/*" />
            <div
              class="upload-drop"
              role="button"
              tabindex="0"
              data-upload-trigger="true"
              aria-controls="auth-modal"
            >
              Drag & drop or click to upload
            </div>
            <div class="upload-meta">
              <p>Here‚Äôs what happens once you drop a video:</p>
              <ul>
                <li>Spot the most exciting Hindi or Hinglish moments.</li>
                <li>Chop them into short clips under a minute.</li>
                <li>Add bold, scroll-stopping captions automatically.</li>
              </ul>
            </div>
            <div class="upload-state">
              <button type="button" class="text-button" id="sign-out" hidden>Sign out</button>
              <div class="upload-progress" id="upload-progress" hidden>
                <div class="progress-bar">
                  <div class="progress-fill" id="upload-progress-fill"></div>
                </div>
                <p class="progress-label" id="upload-progress-label">Preparing upload‚Ä¶</p>
              </div>
              <a id="upload-download-link" class="download-pill" href="#" hidden
                >Download latest reel</a
              >
            </div>
          </div>
          <div class="card-cta-group">
            <a class="card-cta" href="#workflow">See sample output</a>
            <p class="card-note">Sign in with Gmail, Facebook, or Insta to start uploads.</p>
          </div>
        </div>
      </div>
    </header>

    <section class="live-examples" id="live-examples" aria-labelledby="live-examples-heading">
      <div class="live-examples-content">
        <div class="live-examples-copy">
          <p class="tag">Hindi creators live</p>
          <h2 id="live-examples-heading">Trending reels from Insta + YouTube</h2>
          <p>
            See how other Hinglish creators are clipping their feeds right now. Drop your own video
            to join the carousel.
          </p>
        </div>
        <div class="live-grid" role="list">
          <article class="live-card" role="listitem">
            <div class="live-thumb">
              <img
                src="https://images.unsplash.com/photo-1506765515384-028b60a970df?auto=format&fit=crop&w=600&q=80"
                alt="Comedy creator recording a Hindi reel"
                loading="lazy"
              />
              <span class="live-pill">LIVE</span>
              <span class="live-duration">0:42</span>
            </div>
            <div class="live-meta">
              <p class="live-caption">‚Äú‡§≠‡§æ‡§à, ‡§Ø‡•á ‡§∏‡•ç‡§ü‡§æ‡§∞‡•ç‡§ü‡§Ö‡§™ ‡§ï‡§π‡§æ‡§®‡•Ä ‡§§‡•ã reel ‡§π‡•à üí•‚Äù</p>
              <p class="live-handle">@raj.comedy ‚Ä¢ Instagram</p>
            </div>
          </article>
          <article class="live-card" role="listitem">
            <div class="live-thumb">
              <img
                src="https://images.unsplash.com/photo-1517841905240-472988babdf9?auto=format&fit=crop&w=600&q=80"
                alt="Lifestyle influencer filming on phone"
                loading="lazy"
              />
              <span class="live-pill youtube">LIVE</span>
              <span class="live-duration">0:58</span>
            </div>
            <div class="live-meta">
              <p class="live-caption">‚Äú‡§¶‡§ø‡§≤‡•ç‡§≤‡•Ä ‡§∏‡•á work-life balance ‡§ü‡§ø‡§™‡•ç‡§∏ üßò‚Äç‚ôÄÔ∏è‚Äù</p>
              <p class="live-handle">@saanvi.daily ‚Ä¢ YouTube Shorts</p>
            </div>
          </article>
          <article class="live-card" role="listitem">
            <div class="live-thumb">
              <img
                src="https://images.unsplash.com/photo-1494790108377-be9c29b29330?auto=format&fit=crop&w=600&q=80"
                alt="News creator shooting on phone"
                loading="lazy"
              />
              <span class="live-pill tiktok">LIVE</span>
              <span class="live-duration">0:37</span>
            </div>
            <div class="live-meta">
              <p class="live-caption">‚Äú‡§Ü‡§ú ‡§ï‡•Ä politics updates Hinglish ‡§Æ‡•á‡§Ç üóûÔ∏è‚Äù</p>
              <p class="live-handle">@newswithneha ‚Ä¢ TikTok</p>
            </div>
          </article>
        </div>
      </div>
    </section>

    <section class="profile-page" id="profile-page" hidden aria-hidden="true">
      <div class="profile-shell">
        <div class="profile-header">
          <button type="button" class="text-button back-link" id="close-profile-page">
            ‚Üê Back to HindiClip
          </button>
          <p class="tag small-tag">Account overview</p>
          <h2>Creator profile</h2>
          <p class="profile-subtitle">
            Review your plan limits and account metadata. This page updates live as you upgrade.
          </p>
        </div>
        <div class="profile-grid">
          <article class="profile-card profile-card--compact">
            <div class="profile-summary">
              <div>
                <p class="profile-label">Plan</p>
                <strong id="profile-plan">TRIAL</strong>
              </div>
              <div>
                <p class="profile-label">Status</p>
                <strong id="profile-status">Signed out</strong>
              </div>
              <div>
                <p class="profile-label">Valid till</p>
                <strong id="profile-plan-validity">‚Äî</strong>
              </div>
            </div>
            <div class="profile-summary">
              <div>
                <p class="profile-label">Name</p>
                <strong id="profile-name">‚Äî</strong>
              </div>
              <div>
                <p class="profile-label">Email</p>
                <strong id="profile-email">‚Äî</strong>
              </div>
              <div>
                <p class="profile-label">Last sign in</p>
                <strong id="profile-last-login">‚Äî</strong>
              </div>
            </div>
            <div class="profile-summary">
              <div>
                <p class="profile-label">Uploads this month</p>
                <strong id="profile-uploads-count">0</strong>
              </div>
              <div>
                <p class="profile-label">Trial remaining</p>
                <strong id="profile-trial-remaining">1</strong>
              </div>
              <div>
                <p class="profile-label">Next billing</p>
                <strong id="profile-next-billing">When you upgrade</strong>
              </div>
            </div>
            <div class="profile-actions">
              <button type="button" class="secondary" id="profile-sign-out" disabled>
                Sign out
              </button>
              <button type="button" class="primary" data-upload-trigger="true">
                Upgrade plan
              </button>
            </div>
          </article>
        </div>
        <div class="profile-conversions">
          <div class="profile-conversions-header">
            <h3>Recent conversions</h3>
            <p>Track every reel we rendered for you across Instagram, YouTube, and TikTok.</p>
          </div>
          <ul class="conversion-list" id="conversion-list" aria-live="polite" aria-label="Converted videos log">
            <li class="conversion-empty" id="conversion-empty">Sign in to see your conversions.</li>
          </ul>
        </div>
      </div>
    </section>

    <section class="integration" id="integrations">
      <h2>The HindiClip toolkit</h2>
      <div class="integration-logos">
        <div class="logo-card">
          <h3>Smart listening</h3>
          <p>Understands Hinglish slang and notes every hook-worthy line.</p>
        </div>
        <div class="logo-card">
          <h3>Clean clipping</h3>
          <p>Cuts crisp vertical shots with perfectly timed captions.</p>
        </div>
        <div class="logo-card">
          <h3>Fast exports</h3>
          <p>Renders your reel in minutes so you can post the same day.</p>
        </div>
      </div>
    </section>

    <section class="features" id="features">
      <div class="section-heading">
        <h2>Everything you need to publish viral Hindi clips</h2>
        <p>
          HindiClip finds hooks, extracts the best 15‚Äì60 second segments, and
          ships a ready-to-post short with captions, emoji, and platform-perfect
          formatting.
        </p>
      </div>
      <div class="feature-grid">
        <article class="feature-card">
          <h3>Hook hunting</h3>
          <p>
            Aggressive detection for Hindi exclamations like ‚Äú‡§µ‡§æ‡§π!‚Äù and Hinglish
            hype words to surface viral starts.
          </p>
        </article>
        <article class="feature-card">
          <h3>Caption overlays</h3>
          <p>
            Devanagari-safe fonts with bold strokes so subtitles stay legible on
            mobile feeds.
          </p>
        </article>
        <article class="feature-card">
          <h3>Emoji emphasis</h3>
          <p>
            Auto-inserts üî• üòÇ üíØ markers when the speech peaks to increase watch
            time.
          </p>
        </article>
        <article class="feature-card">
          <h3>Smart clip lengths</h3>
          <p>
            Only keeps 15‚Äì60 second sections so your final compilation stays
            under a minute.
          </p>
        </article>
        <article class="feature-card">
          <h3>Platform-ready exports</h3>
          <p>
            9:16 vertical renders with 30fps H.264 and AAC audio for Reels,
            Shorts, and TikTok.
          </p>
        </article>
      </div>
    </section>

    <section class="workflow" id="workflow">
      <div class="section-heading">
        <h2>The fastest path from upload to Hinglish short</h2>
        <p>Here‚Äôs what happens behind the scenes after you hit upload.</p>
      </div>
      <div class="timeline">
        <div class="step">
          <div class="step-number">01</div>
          <h3>Listen in Hindi</h3>
          <p>
            HindiClip listens to your video, understands the tone, and marks every exciting sentence.
          </p>
        </div>
        <div class="step">
          <div class="step-number">02</div>
          <h3>Find the hooks</h3>
          <p>
            High-energy words like ‚Äú‡§µ‡§æ‡§π!‚Äù or ‚Äúbhai!‚Äù get highlighted, and the best 15‚Äì60 second bits are clipped.
          </p>
        </div>
        <div class="step">
          <div class="step-number">03</div>
          <h3>Render & deliver</h3>
          <p>
            Bold captions, emojis, and timing tweaks are added, then your reel is exported and ready to post.
          </p>
        </div>
      </div>
    </section>

    <section class="pricing" id="pricing">
      <div class="section-heading">
        <h2>Fast, predictable pricing</h2>
        <p>Pick the plan that matches your Hindi reel cadence‚Äîfrom a trial clip to yearly savings.</p>
      </div>
      <div class="pricing-cards">
        <article class="pricing-card">
          <h3>Trial</h3>
          <p class="price">Free</p>
          <ul>
            <li>Only 1 video per user</li>
            <li>Smart Hindi/Hinglish captions</li>
            <li>Watermarked export</li>
            <li>Email support</li>
          </ul>
          <a class="primary" href="payment.html?plan=trial">Start trial</a>
        </article>
        <article class="pricing-card highlight">
          <h3>Monthly</h3>
          <p class="price">‚Çπ500<span>/month</span></p>
          <ul>
            <li>Unlimited video uploads</li>
            <li>Priority rendering queue</li>
            <li>Custom caption themes</li>
            <li>WhatsApp + email support</li>
          </ul>
          <a class="primary" href="payment.html?plan=monthly">Subscribe monthly</a>
        </article>
        <article class="pricing-card">
          <h3>Yearly</h3>
          <p class="price">‚Çπ5,400<span>/year</span></p>
          <ul>
            <li>10% off vs monthly plan</li>
            <li>Unlimited uploads</li>
            <li>Brand kit presets</li>
            <li>Priority feature access</li>
          </ul>
          <a class="secondary" href="payment.html?plan=yearly">Switch yearly</a>
        </article>
        <article class="pricing-card">
          <h3>Businesses</h3>
          <p class="price">Let‚Äôs talk</p>
          <ul>
            <li>Dedicated processing power</li>
            <li>Team seats & approvals</li>
            <li>SLA-backed support</li>
            <li>Dedicated success manager</li>
          </ul>
          <a class="secondary" href="mailto:hello@hindiclip.ai">Talk to sales</a>
        </article>
      </div>
    </section>

    <section class="social-proof" id="social">
      <div class="section-heading">
        <h2>Loved by Hindi-first creators</h2>
        <p>See how early adopters are shipping more reels with HindiClip.</p>
      </div>
      <div class="testimonial-grid">
        <blockquote>
          <p>
            ‚Äú‡§π‡§ø‡§Ç‡§¶‡•Ä ‡§Ø‡•Ç‡§ü‡•ç‡§Ø‡•Ç‡§¨ ‡§∏‡•á ‡§∏‡•Ä‡§ß‡•á 45 ‡§∏‡•á‡§ï‡§Ç‡§° ‡§ï‡•á ‡§µ‡§æ‡§Ø‡§∞‡§≤ ‡§∂‡•â‡§∞‡•ç‡§ü‡•ç‡§∏ ‡§Æ‡§ø‡§≤ ‡§ú‡§æ‡§§‡•á ‡§π‡•à‡§Ç‡•§
            ‡§ï‡•à‡§™‡•ç‡§∂‡§® ‡§î‡§∞ ‡§á‡§Æ‡•ã‡§ú‡•Ä ‡§ñ‡•Å‡§¶ ‡§Ü ‡§ú‡§æ‡§§‡•á ‡§π‡•à‡§Ç!‚Äù
          </p>
          <cite>‚Äî ‡§Ü‡§∞‡•ç‡§Ø‡§æ, ‡§∂‡§ø‡§ï‡•ç‡§∑‡§æ ‡§®‡§ø‡§∞‡•ç‡§Æ‡§æ‡§§‡§æ</cite>
        </blockquote>
        <blockquote>
          <p>
            ‚ÄúHooks detection ‡§Æ‡§ú‡•á‡§¶‡§æ‡§∞ ‡§π‡•à‚Äî‡§µ‡§æ‡§ì, ‡§≠‡§æ‡§à, ‡§´‡§æ‡§Ø‡§∞ ‡§ú‡•à‡§∏‡•á ‡§∂‡§¨‡•ç‡§¶ ‡§Æ‡§ø‡§≤‡§§‡•á ‡§π‡•Ä ‡§∏‡§π‡•Ä
            ‡§ï‡•ç‡§≤‡§ø‡§™ ‡§ï‡§ü ‡§ú‡§æ‡§§‡•Ä ‡§π‡•à‡•§‚Äù
          </p>
          <cite>‚Äî ‡•õ‡§æ‡§∞‡§æ, ‡§®‡•ç‡§Ø‡•Ç‡§ú‡§º ‡§ï‡•ç‡§∞‡§ø‡§è‡§ü‡§∞</cite>
        </blockquote>
        <blockquote>
          <p>
            ‚ÄúCompilation ‡§´‡§æ‡§á‡§≤ ‡§î‡§∞ individual ‡§ï‡•ç‡§≤‡§ø‡§™‡•ç‡§∏ ‡§è‡§ï ‡§∏‡§æ‡§• ‡§Æ‡§ø‡§≤ ‡§ú‡§æ‡§§‡•Ä ‡§π‡•à‡§Ç‡•§ Reels
            ‡§™‡•ã‡§∏‡•ç‡§ü ‡§ï‡§∞‡§®‡§æ ‡§Ö‡§¨ 10 ‡§Æ‡§ø‡§®‡§ü ‡§ï‡§æ ‡§ï‡§æ‡§Æ ‡§π‡•à‡•§‚Äù
          </p>
          <cite>‚Äî ‡§ï‡§∞‡§£, ‡§ï‡•â‡§Æ‡•á‡§°‡•Ä ‡§ö‡•à‡§®‡§≤</cite>
        </blockquote>
      </div>
    </section>

    <footer class="footer">
      <div class="footer-content">
        <div>
          <div class="logo">HindiClip</div>
          <p>Hindi-first auto-editing so every creator can publish daily.</p>
        </div>
        <div class="footer-links">
          <a href="#upload">Upload</a>
          <a href="#workflow">Workflow</a>
          <a href="#faq">FAQ</a>
          <a href="mailto:hello@hindiclip.ai">Contact</a>
        </div>
        <div class="footer-cta">
          <p>Ready to go viral?</p>
          <a class="primary" href="#upload">Join the waitlist</a>
        </div>
      </div>
      <p class="footer-note">¬© 2024 HindiClip. All rights reserved.</p>
    </footer>

    <div class="auth-modal" id="auth-modal" role="dialog" aria-modal="true" aria-hidden="true">
      <div class="auth-dialog">
        <button class="modal-close" id="close-auth-modal" type="button" aria-label="Close">
          √ó
        </button>
        <p class="tag small-tag">Secure upload</p>
        <h3>Sign in to continue</h3>
        <p class="auth-subtitle">
          Choose a social login to start uploading. We support Google and Facebook accounts via
          Supabase Auth.
        </p>
        <div class="oauth-buttons">
          <button
            type="button"
            class="oauth-button"
            data-oauth-provider="google"
            aria-label="Continue with Google"
          >
            <span class="oauth-icon">G</span>
            Continue with Google
          </button>
          <button
            type="button"
            class="oauth-button"
            data-oauth-provider="facebook"
            aria-label="Continue with Facebook"
          >
            <span class="oauth-icon">f</span>
            Continue with Facebook
          </button>
          <button
            type="button"
            class="oauth-button coming-soon"
            data-disabled="true"
            aria-disabled="true"
            title="Instagram OAuth is not available through Supabase yet"
          >
            <span class="oauth-icon">IG</span>
            Continue with Instagram (coming soon)
          </button>
        </div>
        <p class="auth-note">
          Instagram login is not yet supported by Supabase Auth. Use Google or Facebook for now.
        </p>
        <div class="auth-divider">
          <span></span>
          <p>or use email</p>
          <span></span>
        </div>
        <form id="email-auth-form" class="auth-form">
          <label class="auth-label" for="auth-email">Email address</label>
          <input type="email" id="auth-email" name="email" placeholder="you@example.com" required />
          <button type="submit" class="primary full-width">Send magic link</button>
        </form>
        <p class="auth-message" id="auth-message" role="status" aria-live="polite"></p>
        <p class="auth-helper">
          Configure your Supabase URL and anon key via <code>window.SUPABASE_URL</code> and
          <code>window.SUPABASE_ANON_KEY</code> or by editing the script below.
        </p>
      </div>
    </div>

    <div class="toast-container" id="toast-container" aria-live="polite"></div>

    <script type="module">
      import { createClient } from 'https://esm.sh/@supabase/supabase-js@2.44.2';

      const SUPABASE_URL =
        window.SUPABASE_URL || 'https://gvttkycxbuodqwhbbsee.supabase.co';
      const SUPABASE_ANON_KEY =
        window.SUPABASE_ANON_KEY ||
        'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd2dHRreWN4YnVvZHF3aGJic2VlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ1MTMwMTEsImV4cCI6MjA4MDA4OTAxMX0.sr4wj8MBbXYok6LiRNnvUvr9sURVwXDphX0bJZVfJhY';
      const redirectUrl = `${window.location.origin}${window.location.pathname}`;
      const hasValidSupabaseConfig = SUPABASE_URL && SUPABASE_ANON_KEY;
      const supabase = hasValidSupabaseConfig ? createClient(SUPABASE_URL, SUPABASE_ANON_KEY) : null;
      const authEnabled = Boolean(supabase);

      const uploadTriggers = document.querySelectorAll('[data-upload-trigger]');
      const uploadDrop = document.querySelector('.upload-drop');
      const heroFileInput = document.getElementById('upload-input');
      const authModal = document.getElementById('auth-modal');
      const closeModalButton = document.getElementById('close-auth-modal');
      const authForm = document.getElementById('email-auth-form');
      const authMessage = document.getElementById('auth-message');
      const oauthButtons = document.querySelectorAll('[data-oauth-provider]');
      const uploadStatus = document.getElementById('upload-status');
      const signOutButton = document.getElementById('sign-out');
      const userPill = document.getElementById('user-pill');
      const userAvatar = document.getElementById('user-avatar');
      const userNameLabel = document.getElementById('user-name');
      const profilePage = document.getElementById('profile-page');
      const closeProfilePageButton = document.getElementById('close-profile-page');
      const profilePlan = document.getElementById('profile-plan');
      const profilePlanValidity = document.getElementById('profile-plan-validity');
      const profileStatus = document.getElementById('profile-status');
      const profileName = document.getElementById('profile-name');
      const profileEmail = document.getElementById('profile-email');
      const profileLastLogin = document.getElementById('profile-last-login');
      const profileUploadsCount = document.getElementById('profile-uploads-count');
      const profileTrialRemaining = document.getElementById('profile-trial-remaining');
      const profileNextBilling = document.getElementById('profile-next-billing');
      const profileSignOutButton = document.getElementById('profile-sign-out');
      const conversionList = document.getElementById('conversion-list');
      const conversionEmpty = document.getElementById('conversion-empty');
      const localUploadForm = document.getElementById('local-upload-form');
      const localUploadInput = document.getElementById('local-upload-input');
      const localUploadStatus = document.getElementById('local-upload-status');
      const localUploadButton = localUploadForm?.querySelector('button[type="submit"]');
      const urlUploadForm = document.getElementById('url-upload-form');
      const urlUploadInput = document.getElementById('url-upload-input');
      const urlUploadStatus = document.getElementById('url-upload-status');
      const urlUploadButton = urlUploadForm?.querySelector('button[type="submit"]');
      const uploadProgress = document.getElementById('upload-progress');
      const uploadProgressFill = document.getElementById('upload-progress-fill');
      const uploadProgressLabel = document.getElementById('upload-progress-label');
      const uploadDownloadLink = document.getElementById('upload-download-link');
      let currentSession = null;
      const isUploadAllowed = () => (authEnabled ? Boolean(currentSession) : false);
      const toastContainer = document.getElementById('toast-container');

      const uploadProgressStages = [
        { value: 1, label: 'Queued upload‚Ä¶' },
        { value: 12, label: 'Uploading video‚Ä¶' },
        { value: 35, label: 'Listening in Hindi‚Ä¶' },
        { value: 55, label: 'Hunting the hooks‚Ä¶' },
        { value: 78, label: 'Rendering captions‚Ä¶' },
        { value: 92, label: 'Packaging your reel‚Ä¶' },
      ];
      let uploadProgressTimers = [];
      let uploadProgressHideTimer = null;
      let uploadLongWaitTimer = null;

      const clearUploadProgressTimers = () => {
        uploadProgressTimers.forEach((timer) => clearTimeout(timer));
        uploadProgressTimers = [];
        if (uploadProgressHideTimer) {
          clearTimeout(uploadProgressHideTimer);
          uploadProgressHideTimer = null;
        }
        if (uploadLongWaitTimer) {
          clearTimeout(uploadLongWaitTimer);
          uploadLongWaitTimer = null;
        }
      };

      const resetUploadProgress = () => {
        clearUploadProgressTimers();
        if (uploadProgressFill) uploadProgressFill.style.width = '0%';
        if (uploadProgressLabel) uploadProgressLabel.textContent = '';
        if (uploadProgress) uploadProgress.hidden = true;
      };

      const setUploadProgress = (value = 0, label = '') => {
        if (!uploadProgress || !uploadProgressFill) return;
        uploadProgress.hidden = false;
        const safeValue = Math.max(0, Math.min(100, value));
        uploadProgressFill.style.width = `${safeValue}%`;
        if (uploadProgressLabel) uploadProgressLabel.textContent = label;
      };

      const startUploadProgress = () => {
        if (!uploadProgress) return;
        resetUploadProgress();
        setUploadProgress(1, 'Queued upload‚Ä¶');
        uploadProgressStages.forEach((stage, index) => {
          const timer = window.setTimeout(() => {
            setUploadProgress(stage.value, stage.label);
          }, (index + 1) * 4000);
          uploadProgressTimers.push(timer);
        });
        // Safety net: after ~30s, reassure the user we‚Äôre still working in Supabase backend.
        uploadLongWaitTimer = window.setTimeout(() => {
          setUploadProgress(
            96,
            "We‚Äôll let you know once we convert your reel. Uploading to Supabase backend‚Ä¶"
          );
        }, 30000);
      };

      const completeUploadProgress = () => {
        if (!uploadProgress) return;
        clearUploadProgressTimers();
        setUploadProgress(100, 'Download ready!');
        uploadProgressHideTimer = window.setTimeout(() => {
          resetUploadProgress();
        }, 2500);
      };

      const failUploadProgress = (message) => {
        if (!uploadProgress) return;
        clearUploadProgressTimers();
        setUploadProgress(0, message || 'Upload failed. Try again.');
        uploadProgressHideTimer = window.setTimeout(() => {
          resetUploadProgress();
        }, 3000);
      };

      const toAbsoluteUrl = (value = '') => {
        if (!value) return '';
        if (value.startsWith('http')) return value;
        const normalized = value.startsWith('/') ? value : `/${value}`;
        return `${window.location.origin}${normalized}`;
      };

      const showDownloadLink = (url, label = 'Download reel') => {
        if (!uploadDownloadLink) return;
        if (!url) {
          uploadDownloadLink.hidden = true;
          uploadDownloadLink.removeAttribute('href');
          uploadDownloadLink.removeAttribute('download');
          return;
        }
        const absoluteUrl = toAbsoluteUrl(url);
        uploadDownloadLink.hidden = false;
        uploadDownloadLink.href = absoluteUrl;
        uploadDownloadLink.textContent = label;
        const sanitizedName = label?.replace(/\s+/g, '_') || 'hindiclip_output.mp4';
        uploadDownloadLink.setAttribute('download', sanitizedName);
      };

      const hideDownloadLink = () => {
        if (!uploadDownloadLink) return;
        uploadDownloadLink.hidden = true;
        uploadDownloadLink.removeAttribute('href');
        uploadDownloadLink.removeAttribute('download');
      };
      const fallbackConversions = [
        {
          id: 'hc-001',
          title: 'standup_snippet.mov',
          platform: 'Instagram Reels',
          duration: '0:42',
          status: 'Completed',
          finishedAt: '2024-09-10T09:24:00Z',
        },
        {
          id: 'hc-002',
          title: 'podcast_hook.mp4',
          platform: 'YouTube Shorts',
          duration: '0:55',
          status: 'Completed',
          finishedAt: '2024-09-09T14:02:00Z',
        },
        {
          id: 'hc-003',
          title: 'news_flash.mov',
          platform: 'TikTok',
          duration: '0:37',
          status: 'Queued',
          finishedAt: '2024-09-09T13:50:00Z',
        },
      ];
      let currentConversions = [];
      const addConversionRecord = (record) => {
        currentConversions = [record, ...currentConversions].slice(0, 10);
        renderConversions(currentConversions, isUploadAllowed());
      };
      const updateConversionRecord = (id, updates) => {
        let hasChanges = false;
        currentConversions = currentConversions.map((item) => {
          if (item.id !== id) return item;
          hasChanges = true;
          return { ...item, ...updates };
        });
        if (hasChanges) {
          renderConversions(currentConversions, isUploadAllowed());
        }
      };

      const cleanOAuthParams = () => {
        if (!window.history?.replaceState) return;
        window.history.replaceState({}, document.title, redirectUrl);
      };

      const createToast = (message, variant = 'default', timeout = 3000) => {
        if (!toastContainer) return;
        const toast = document.createElement('div');
        toast.className = `toast ${variant}`;
        toast.innerHTML = `
          <span>${message}</span>
          <button type="button" aria-label="Dismiss">√ó</button>
        `;
        const dismiss = () => {
          toast.remove();
        };
        toast.querySelector('button')?.addEventListener('click', dismiss);
        toastContainer.appendChild(toast);
        if (timeout > 0) {
          setTimeout(dismiss, timeout);
        }
      };

      const setAuthMessage = (message = '', variant) => {
        if (!authMessage) return;
        authMessage.textContent = message;
        authMessage.classList.remove('success', 'error');
        if (variant === 'success') authMessage.classList.add('success');
        if (variant === 'error') authMessage.classList.add('error');
      };

      const setFormStatus = (element, message = '', variant = 'muted') => {
        if (!element) return;
        element.textContent = message;
        element.classList.remove('success', 'error');
        if (variant === 'success') element.classList.add('success');
        if (variant === 'error') element.classList.add('error');
      };

      const toggleModal = (open) => {
        if (!authModal) return;
        authModal.classList.toggle('is-open', open);
        authModal.setAttribute('aria-hidden', open ? 'false' : 'true');
        if (!open) {
          setAuthMessage('');
        }
      };

      const getDisplayName = (user) => {
        if (!user) return 'Creator';
        return (
          user.user_metadata?.full_name ||
          user.user_metadata?.name ||
          user.email?.split('@')[0] ||
          'Creator'
        );
      };

      const getInitials = (name = '') => {
        const initials = name
          .split(' ')
          .filter(Boolean)
          .slice(0, 2)
          .map((part) => part[0])
          .join('')
          .toUpperCase();
        return initials || 'HC';
      };

      const toggleUserPill = (visible) => {
        if (!userPill) return;
        userPill.hidden = !visible;
        if (!visible) {
          userPill.setAttribute('aria-expanded', 'false');
        }
      };

      const setUploadToolsEnabled = (enabled) => {
        if (localUploadInput) localUploadInput.disabled = !enabled;
        if (localUploadButton) localUploadButton.disabled = !enabled;
        if (urlUploadInput) urlUploadInput.disabled = !enabled;
        if (urlUploadButton) urlUploadButton.disabled = !enabled;
      };

      setUploadToolsEnabled(false);
      resetUploadProgress();
      hideDownloadLink();
        if (!authEnabled) {
          createToast('Add your Supabase credentials to enable uploads.', 'error');
        }

      const formatFileSize = (bytes = 0) => {
        if (!Number.isFinite(bytes)) return '0 B';
        const units = ['B', 'KB', 'MB', 'GB'];
        let size = bytes;
        let index = 0;
        while (size >= 1024 && index < units.length - 1) {
          size /= 1024;
          index += 1;
        }
        const precision = size >= 10 || index === 0 ? 0 : 1;
        return `${size.toFixed(precision)} ${units[index]}`;
      };

      const formatDurationLabel = (seconds = 0) => {
        if (!Number.isFinite(seconds) || seconds <= 0) return '‚Äî';
        const mins = Math.floor(seconds / 60);
        const secs = Math.floor(seconds % 60)
          .toString()
          .padStart(2, '0');
        return `${mins}:${secs}`;
      };

      const getDownloadTarget = (payload = {}) => {
        if (payload?.compilation?.url) {
          return {
            url: payload.compilation.url,
            filename: payload.compilation.file || 'HINDI_SHORTS_COMPILATION.mp4',
          };
        }
        const firstClip = payload?.clips?.[0];
        if (firstClip?.url) {
          return {
            url: firstClip.url,
            filename: firstClip.file || 'HINDICLIP_CLIP.mp4',
          };
        }
        return null;
      };

      const triggerAutoDownload = (target) => {
        if (!target?.url) return;
        const anchor = document.createElement('a');
        anchor.href = toAbsoluteUrl(target.url);
        if (target.filename) {
          anchor.download = target.filename;
        }
        anchor.style.display = 'none';
        document.body.appendChild(anchor);
        anchor.click();
        document.body.removeChild(anchor);
      };

      const uploadVideoFile = async (file) => {
        const formData = new FormData();
        formData.append('video', file, file.name || 'upload.mp4');
        const response = await fetch('/api/process-video', {
          method: 'POST',
          body: formData,
        });
        let payload = {};
        try {
          payload = await response.json();
        } catch (error) {
          console.error('Failed to parse response', error);
        }
        if (!response.ok) {
          const message = payload?.error || 'Processing failed. Please try again.';
          const error = new Error(message);
          error.status = response.status;
          error.payload = payload;
          throw error;
        }
        return payload;
      };

      const startLocalUpload = async (file) => {
        if (!file) return;
        const maxSize = 2 * 1024 * 1024 * 1024;
        if (file.size > maxSize) {
        setFormStatus(localUploadStatus, 'Please choose a video under 2 GB.', 'error');
        createToast('Please choose a video under 2 GB.', 'error');
          hideDownloadLink();
          resetUploadProgress();
          return;
        }
        hideDownloadLink();
        startUploadProgress();
        const sizeLabel = formatFileSize(file.size);
        setFormStatus(localUploadStatus, `Uploading ${file.name} (${sizeLabel})...`);
        createToast(`Uploading ${file.name} (${sizeLabel})`, 'success');
        const jobId = `local-${Date.now()}`;
        addConversionRecord({
          id: jobId,
          title: file.name,
          platform: 'Local upload',
          duration: 'Rendering‚Ä¶',
          status: 'Processing',
          finishedAt: new Date().toISOString(),
          downloadUrl: null,
        });
        try {
          const payload = await uploadVideoFile(file);
          const clipCount = payload?.clips?.length || 0;
          const clipLabel = clipCount === 1 ? 'clip' : 'clips';
          const compilationNote = payload?.compilation ? ' + compilation' : '';
          const downloadTarget = getDownloadTarget(payload);
          const downloadUrl =
            downloadTarget?.url || payload?.clips?.[0]?.url || null;
          const resolvedDownloadUrl = downloadUrl ? toAbsoluteUrl(downloadUrl) : '';
          setFormStatus(
            localUploadStatus,
            `Processing complete. ${clipCount} ${clipLabel}${compilationNote} ready in outputs/. Starting download...`,
            'success'
          );
          createToast(
            downloadTarget
              ? `Finished ${file.name}. Downloading ${downloadTarget.filename || 'your reel'}...`
              : `Finished ${file.name}. Download your files under outputs/.`,
            'success'
          );
          if (localUploadInput) localUploadInput.value = '';
          updateConversionRecord(jobId, {
            status: 'Completed',
            finishedAt: new Date().toISOString(),
            platform: 'HindiClip render',
            duration: formatDurationLabel(payload?.compilation?.duration || payload?.videoDuration),
            downloadUrl: resolvedDownloadUrl || null,
            downloadLabel: downloadTarget?.filename || 'Download output',
          });
          completeUploadProgress();
          showDownloadLink(resolvedDownloadUrl || null, downloadTarget?.filename || 'Download output');
          if (resolvedDownloadUrl) {
            triggerAutoDownload({ url: resolvedDownloadUrl, filename: downloadTarget?.filename });
          }
        } catch (error) {
          const isTimeout = error?.status === 504 || /background/i.test(error?.message || '');
          const message =
            error?.message ||
            (isTimeout
              ? "We're still converting this reel in the backend. We'll notify you when it's ready."
              : 'Processing failed. Please try again.');
          if (isTimeout) {
            setUploadProgress(
              98,
              "We‚Äôll let you know once we convert your reel. Uploading to Supabase backend‚Ä¶"
            );
            setFormStatus(
              localUploadStatus,
              "Still converting on the backend. We'll let you know once it‚Äôs done.",
              'success'
            );
            createToast("Still converting on the backend. We'll notify you shortly.", 'success');
            updateConversionRecord(jobId, {
              status: 'Processing (backend)',
              finishedAt: new Date().toISOString(),
              platform: 'HindiClip render',
              downloadUrl: null,
            });
            // Do not throw; keep UI calm and let backend finish.
            return;
          }
          setFormStatus(localUploadStatus, message, 'error');
          createToast(message, 'error');
          updateConversionRecord(jobId, {
            status: 'Failed',
            finishedAt: new Date().toISOString(),
            platform: 'Processing error',
            downloadUrl: null,
          });
          failUploadProgress(message);
          hideDownloadLink();
          throw error;
        }
      };

      const isValidVideoUrl = (value) => {
        try {
          const parsed = new URL(value);
          return parsed.protocol === 'https:' || parsed.protocol === 'http:';
        } catch {
          return false;
        }
      };

      const processUrlUpload = (url) =>
        new Promise((resolve) => {
          let hostname = 'your source';
          try {
            hostname = new URL(url).hostname;
          } catch {
            // ignore invalid URL here; it is validated earlier
          }
          const jobId = `url-${Date.now()}`;
          addConversionRecord({
            id: jobId,
            title: hostname,
            platform: 'Remote import',
            duration: '0:58',
            status: 'Queued',
            finishedAt: new Date().toISOString(),
          });
          setTimeout(() => {
            const email = currentSession?.user?.email || 'you';
            setFormStatus(
              urlUploadStatus,
              `Fetched ${hostname}. We'll email ${email} when the clips are ready.`,
              'success'
            );
            createToast('Video imported successfully. We will notify you when clips are ready.', 'success');
            if (urlUploadInput) urlUploadInput.value = '';
            updateConversionRecord(jobId, {
              status: 'Completed',
              finishedAt: new Date().toISOString(),
              platform: hostname,
            });
            resolve();
          }, 1500);
        });

      const getPlanDetails = (user) => {
        const planSource =
          user?.user_metadata?.plan ||
          user?.user_metadata?.subscription ||
          user?.app_metadata?.plan ||
          user?.app_metadata?.subscription;
        const normalizedPlan = `${planSource || 'TRIAL'}`.trim().toUpperCase();
        const isPaid = normalizedPlan === 'PAID' || normalizedPlan === 'PRO' || normalizedPlan === 'STUDIO';
        const displayPlan = isPaid ? 'PAID' : 'TRIAL';
        const rawValidity =
          user?.user_metadata?.plan_valid_until ||
          user?.user_metadata?.planValidUntil ||
          user?.app_metadata?.plan_valid_until;
        if (!isPaid) {
          return { displayPlan, validUntilLabel: '‚Äî' };
        }
        if (!rawValidity) {
          return { displayPlan, validUntilLabel: 'Pending' };
        }
        const date = new Date(rawValidity);
        if (Number.isNaN(date.getTime())) {
          return { displayPlan, validUntilLabel: rawValidity };
        }
        const validUntilLabel = date.toLocaleDateString(undefined, {
          year: 'numeric',
          month: 'short',
          day: 'numeric',
        });
        return { displayPlan, validUntilLabel };
      };

      const formatRelativeTime = (value) => {
        if (!value) return 'Just now';
        const target = new Date(value);
        if (Number.isNaN(target.getTime())) return value;
        const elapsed = Date.now() - target.getTime();
        const minutes = Math.floor(Math.abs(elapsed) / 60000);
        if (minutes < 1) return 'Just now';
        if (minutes < 60) return `${minutes}m ago`;
        const hours = Math.floor(minutes / 60);
        if (hours < 24) return `${hours}h ago`;
        const days = Math.floor(hours / 24);
        return `${days}d ago`;
      };

      const getConvertedVideos = (user, metadata) => {
        const stored = user?.user_metadata?.conversions;
        if (Array.isArray(stored) && stored.length) {
          return stored;
        }
        return metadata.displayPlan === 'PAID' ? fallbackConversions : [];
      };

      const clearConversions = () => {
        if (!conversionList) return;
        const cards = conversionList.querySelectorAll('.conversion-card');
        cards.forEach((card) => card.remove());
      };

      const renderConversions = (items = [], isSignedIn = false) => {
        if (!conversionList) return;
        clearConversions();
        if (!items.length) {
          if (conversionEmpty) {
            conversionEmpty.hidden = false;
            conversionEmpty.textContent = isSignedIn
              ? 'No conversions yet. Upload a video to see it here.'
              : 'Sign in to see your conversions.';
          }
          return;
        }
        if (conversionEmpty) {
          conversionEmpty.hidden = true;
        }
        items.forEach((item) => {
          const li = document.createElement('li');
          li.className = 'conversion-card';
          const statusValue = `${item.status || 'Completed'}`.toLowerCase();
          let statusClass = 'success';
          if (statusValue === 'queued' || statusValue === 'processing') {
            statusClass = 'pending';
          } else if (statusValue === 'failed' || statusValue === 'error') {
            statusClass = 'error';
          }
          const resolvedDownloadUrl = item.downloadUrl
            ? toAbsoluteUrl(item.downloadUrl)
            : '';
          const downloadMarkup = resolvedDownloadUrl
            ? `<div class="conversion-actions"><a class="conversion-download" href="${resolvedDownloadUrl}" download>${item.downloadLabel || 'Download'}</a></div>`
            : '';
          li.innerHTML = `
            <div class="conversion-header">
              <p class="conversion-title">${item.title || 'Untitled video'}</p>
              <span class="conversion-status ${statusClass}">${item.status || 'Completed'}</span>
            </div>
            <div class="conversion-meta">
              <p>${item.platform || 'Instagram Reels'} ‚Ä¢ ${item.duration || '0:45'}</p>
              <p>${formatRelativeTime(item.finishedAt)}</p>
            </div>
            ${downloadMarkup}
          `;
          conversionList.appendChild(li);
        });
      };

      const getUsageStats = (user, metadata) => {
        const uploads = user?.user_metadata?.uploads_this_month ?? (metadata.displayPlan === 'TRIAL' ? '0' : '‚Äî');
        const remainingTrial = user?.user_metadata?.trial_remaining ?? (metadata.displayPlan === 'TRIAL' ? '1' : '0');
        let nextBilling = user?.user_metadata?.next_billing;
        if (!nextBilling) {
          nextBilling =
            metadata.displayPlan === 'PAID'
              ? metadata.validUntilLabel !== '‚Äî'
                ? metadata.validUntilLabel
                : 'Pending billing date'
              : 'When you upgrade';
        }
        return {
          uploads,
          remainingTrial,
          nextBilling,
        };
      };

      const formatLastLogin = (value) => {
        if (!value) return '‚Äî';
        const date = new Date(value);
        if (Number.isNaN(date.getTime())) return value;
        return `${date.toLocaleDateString(undefined, {
          day: 'numeric',
          month: 'short',
          year: 'numeric',
        })} ¬∑ ${date.toLocaleTimeString(undefined, {
          hour: '2-digit',
          minute: '2-digit',
        })}`;
      };

      const ensureSession = async () => {
        if (currentSession) return currentSession;
        if (!authEnabled || !supabase) return null;
        const {
          data: { session },
        } = await supabase.auth.getSession();
        if (session) {
          updateAuthState(session);
        }
        return session;
      };

      const openProfilePage = () => {
        if (!profilePage) return;
        profilePage.hidden = false;
        profilePage.setAttribute('aria-hidden', 'false');
        document.body.classList.add('is-profile-open');
        userPill?.setAttribute('aria-expanded', 'true');
        window.scrollTo({ top: 0, behavior: 'smooth' });
      };

      const closeProfilePage = () => {
        if (!profilePage) return;
        profilePage.hidden = true;
        profilePage.setAttribute('aria-hidden', 'true');
        document.body.classList.remove('is-profile-open');
        userPill?.setAttribute('aria-expanded', 'false');
      };

      const handleOAuthRedirect = async () => {
        if (!supabase) return;
        const hash = window.location.hash || '';
        const search = new URLSearchParams(window.location.search);
        const hasOAuthTokens =
          hash.includes('access_token=') ||
          search.has('code') ||
          search.has('error_description');
        if (!hasOAuthTokens) return;
        const {
          data: { session },
          error,
        } = await supabase.auth.getSessionFromUrl({ storeSession: true });
        if (error) {
        createToast('Authentication failed. Please try again.', 'error');
          setAuthMessage(error.message, 'error');
          cleanOAuthParams();
          return;
        }
        updateAuthState(session);
        cleanOAuthParams();
      };

      const handleUploadRequest = async () => {
        if (!authEnabled || !supabase) {
          createToast('Add your Supabase credentials to enable uploads.', 'error');
          setAuthMessage('Add Supabase credentials to continue.', 'error');
          toggleModal(true);
          return;
        }
        const session = await ensureSession();
        if (session) {
          createToast('Ready for your next upload. Drop a video to start processing.', 'success');
          heroFileInput?.click();
          return;
        }
        toggleModal(true);
      };

      const trapUploadTriggers = () => {
        uploadTriggers.forEach((trigger) => {
          const invoke = (event) => {
            event.preventDefault();
            handleUploadRequest();
          };
          trigger.addEventListener('click', invoke);
          trigger.addEventListener('keydown', (event) => {
            if (event.key === 'Enter' || event.key === ' ') {
              event.preventDefault();
              handleUploadRequest();
            }
          });
        });
      };

      const updateAuthState = (session) => {
        currentSession = session;
        if (!session) {
          signOutButton.hidden = true;
          toggleUserPill(false);
          createToast('Sign in to upload your first reel.', 'error');
          setUploadToolsEnabled(false);
          setFormStatus(localUploadStatus, '');
          setFormStatus(urlUploadStatus, '');
          hideDownloadLink();
          resetUploadProgress();
          closeProfilePage();
          if (profilePlan) profilePlan.textContent = 'TRIAL';
          if (profilePlanValidity) profilePlanValidity.textContent = '‚Äî';
          if (profileStatus) profileStatus.textContent = 'Signed out';
          if (profileName) profileName.textContent = '‚Äî';
          if (profileEmail) profileEmail.textContent = '‚Äî';
          if (profileLastLogin) profileLastLogin.textContent = '‚Äî';
          if (profileUploadsCount) profileUploadsCount.textContent = '0';
          if (profileTrialRemaining) profileTrialRemaining.textContent = '1';
          if (profileNextBilling) profileNextBilling.textContent = 'When you upgrade';
          profileSignOutButton?.setAttribute('disabled', 'true');
          currentConversions = [];
          renderConversions([], false);
          return;
        }
        const email = session.user?.email ?? 'your account';
        const displayName = getDisplayName(session.user);
        const { displayPlan, validUntilLabel } = getPlanDetails(session.user);
        const usageStats = getUsageStats(session.user, { displayPlan, validUntilLabel });
        const conversions = getConvertedVideos(session.user, { displayPlan, validUntilLabel });
        signOutButton.hidden = false;
        toggleUserPill(true);
        if (userNameLabel) userNameLabel.textContent = displayName;
        if (userAvatar) userAvatar.textContent = getInitials(displayName);
        if (profilePlan) profilePlan.textContent = displayPlan;
        if (profilePlanValidity) profilePlanValidity.textContent = validUntilLabel;
        if (profileStatus) profileStatus.textContent = 'Active';
        if (profileName) profileName.textContent = displayName;
        if (profileEmail) profileEmail.textContent = email;
        if (profileLastLogin) profileLastLogin.textContent = formatLastLogin(session.user?.last_sign_in_at);
        if (profileUploadsCount) profileUploadsCount.textContent = usageStats.uploads;
        if (profileTrialRemaining) profileTrialRemaining.textContent = usageStats.remainingTrial;
        if (profileNextBilling) profileNextBilling.textContent = usageStats.nextBilling;
        profileSignOutButton?.removeAttribute('disabled');
        setUploadToolsEnabled(true);
        createToast('Ready for your next upload. Drop a video to start processing.', 'success');
        currentConversions = Array.isArray(conversions) ? conversions : [];
        renderConversions(currentConversions, true);
      };

      const initializeAuth = async () => {
        trapUploadTriggers();
        if (!authEnabled || !supabase) {
          createToast('Add your Supabase credentials to enable uploads.', 'error');
          setUploadToolsEnabled(false);
          return;
        }

        await handleOAuthRedirect();

        const {
          data: { session },
        } = await supabase.auth.getSession();
        updateAuthState(session);

        supabase.auth.onAuthStateChange((_event, currentSession) => {
          updateAuthState(currentSession);
          if (currentSession) toggleModal(false);
        });
      };

      authForm?.addEventListener('submit', async (event) => {
        event.preventDefault();
        if (!supabase) {
          setAuthMessage('Add Supabase credentials to continue.', 'error');
          return;
        }
        const formData = new FormData(authForm);
        const email = formData.get('email');
        setAuthMessage('Sending magic link...');

        const { error } = await supabase.auth.signInWithOtp({
          email,
          options: {
            shouldCreateUser: true,
            emailRedirectTo: redirectUrl,
          },
        });

        if (error) {
          setAuthMessage(error.message, 'error');
          return;
        }

        setAuthMessage('Check your inbox for the magic link.', 'success');
      });

      const initOAuthButtons = () => {
        oauthButtons.forEach((button) => {
          const provider = button.dataset.oauthProvider;
          const disabled = button.dataset.disabled === 'true';
          if (disabled) {
            button.addEventListener('click', () => {
              setAuthMessage('Instagram login is not available through Supabase yet.', 'error');
            });
            return;
          }
          button.addEventListener('click', async () => {
            if (!supabase) {
              setAuthMessage('Add Supabase credentials to continue.', 'error');
              return;
            }
            setAuthMessage(`Redirecting to ${provider}...`);
            const { error } = await supabase.auth.signInWithOAuth({
              provider,
              options: {
                redirectTo: redirectUrl,
              },
            });
            if (error) {
              setAuthMessage(error.message, 'error');
            }
          });
        });
      };

      const handleSignOut = async () => {
        if (!supabase) return;
        await supabase.auth.signOut();
        toggleModal(false);
      };

      closeModalButton?.addEventListener('click', () => toggleModal(false));
      authModal?.addEventListener('click', (event) => {
        if (event.target === authModal) toggleModal(false);
      });

      uploadDownloadLink?.addEventListener('click', (event) => {
        if (!uploadDownloadLink?.href || uploadDownloadLink.href === window.location.href) {
          event.preventDefault();
        }
      });

      uploadDrop?.addEventListener('dragover', (event) => {
        event.preventDefault();
      });

      uploadDrop?.addEventListener('drop', async (event) => {
        event.preventDefault();
        if (!isUploadAllowed()) {
          handleUploadRequest();
          return;
        }
        const file = event.dataTransfer?.files?.[0];
        if (!file) {
        createToast('No video detected in that drop.', 'error');
          return;
        }
        try {
          await startLocalUpload(file);
        } catch {
          // errors handled above
        }
      });

      heroFileInput?.addEventListener('change', async (event) => {
        const file = event.target.files?.[0];
        if (!file) return;
        if (!isUploadAllowed()) {
          heroFileInput.value = '';
          handleUploadRequest();
          return;
        }
        try {
          await startLocalUpload(file);
        } catch {
          // errors handled above
        }
        heroFileInput.value = '';
      });

      localUploadForm?.addEventListener('submit', async (event) => {
        event.preventDefault();
        if (!isUploadAllowed()) {
          setFormStatus(localUploadStatus, 'Sign in to upload a video.', 'error');
          handleUploadRequest();
          return;
        }
        const file = localUploadInput?.files?.[0];
        if (!file) {
          setFormStatus(localUploadStatus, 'Select a video file first.', 'error');
          return;
        }
        try {
          await startLocalUpload(file);
        } catch {
          // errors handled above
        }
      });

      urlUploadForm?.addEventListener('submit', async (event) => {
        event.preventDefault();
        if (!isUploadAllowed()) {
          setFormStatus(urlUploadStatus, 'Sign in to import a video.', 'error');
          handleUploadRequest();
          return;
        }
        const value = urlUploadInput?.value?.trim();
        if (!value || !isValidVideoUrl(value)) {
          setFormStatus(urlUploadStatus, 'Enter a valid https:// video link.', 'error');
          return;
        }
        setFormStatus(urlUploadStatus, 'Fetching video...');
        createToast('Fetching video link...', 'success');
        await processUrlUpload(value);
      });

      userPill?.addEventListener('click', (event) => {
        event.preventDefault();
        if (!isUploadAllowed()) {
          handleUploadRequest();
          return;
        }
        openProfilePage();
      });

      const resetUrlStatus = () => setFormStatus(urlUploadStatus, '');
      const resetLocalStatus = () => setFormStatus(localUploadStatus, '');

      urlUploadInput?.addEventListener('input', resetUrlStatus);
      localUploadInput?.addEventListener('input', resetLocalStatus);

      const signOutTargets = [signOutButton, profileSignOutButton];
      signOutTargets.forEach((button) => {
        button?.addEventListener('click', handleSignOut);
      });

      closeProfilePageButton?.addEventListener('click', closeProfilePage);
      profilePage?.addEventListener('click', (event) => {
        if (event.target === profilePage) {
          closeProfilePage();
        }
      });

      initializeAuth();
      initOAuthButtons();
    </script>
  </body>
</html>
